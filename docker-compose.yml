
services:
  stream:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"      # HTTP
      - "443:443"    # HTTPS
      - "1935:1935"  # RTMP
    volumes:
      - ./videos:/opt/videos:ro  # Mount videos directory as read-only for stream service
      - ./certs:/etc/nginx/ssl:ro  # Mount certs for SSL
      - stream-control:/tmp/control:rw  # Shared control volume for video switching
    depends_on:
      - manage
    restart: unless-stopped

  manage:
    build:
      context: .
      dockerfile: manage/Dockerfile
    expose:
      - "5000"
    volumes:
      - ./videos:/opt/videos:rw
      - stream-control:/tmp/control:rw  # Shared control volume for video switching
    restart: unless-stopped

volumes:
  stream-control:  # Named volume for inter-container communication